# AutoRest Extensions for OpenAPI 2.0

### Introduction

The following documents describes AutoRest specific vendor extensions for [OpenAPI 2.0](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md) schema. Code generation impact and support may vary per language. Some of the extensions are applicable to ARM APIs only, some are only metadatas and would not trigger code generator update.

### Generic Extensions

- [x-ms-code-generation-settings](#x-ms-code-generation-settings) - enables passing code generation settings via OpenAPI definition (_deprecated! Please use configuration files instead._)
- [x-ms-skip-url-encoding](#x-ms-skip-url-encoding) - skips URL encoding for path and query parameters
- [x-ms-enum](#x-ms-enum) - additional metadata for enums
- [x-ms-parameter-grouping](#x-ms-parameter-grouping) - groups method parameters in generated clients
- [x-ms-parameter-location](#x-ms-parameter-location) - provides a mechanism to specify that the global parameter is actually a parameter on the operation and not a client property.
- [x-ms-paths](#x-ms-paths) - alternative to [Paths Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#pathsObject) that allows [Path Item Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#pathItemObject) to have query parameters for non pure REST APIs
- [x-ms-client-name](#x-ms-client-name) - allows control over identifier names used in client-side code generation for parameters and schema properties.
- [x-ms-external](#x-ms-external) - allows specific [Definition Objects](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#definitionsObject) to be excluded from code generation
- [x-ms-discriminator-value](#x-ms-discriminator-value) - maps discriminator value on the wire with the definition name.
- [x-ms-client-flatten](#x-ms-client-flatten) - flattens client model property or parameter.
- [x-ms-parameterized-host](#x-ms-parameterized-host) - replaces the fixed host with a host template that can be replaced with variable parameters.
- [x-ms-mutability](#x-ms-mutability) - provides insight to Autorest on how to generate code. It doesn't alter the modeling of what is actually sent on the wire.
- [x-ms-examples](#x-ms-examples) - describes the format for specifying examples for request and response of an operation in an OpenAPI definition.
- [x-ms-error-response](#x-ms-error-response) - indicates whether the response status code should be treated as an error response
- [x-ms-text](#x-ms-text) - XML helper for scenario with attributes and text on the same XML node
- [x-ms-client-default](#x-ms-client-default) - Set default value for properties and parameters
- [x-ms-pageable](#x-ms-pageable) - allows paging through lists of data.
- [x-ms-long-running-operation](#x-ms-long-running-operation) - indicates that the operation implemented Long Running Operation pattern as defined by the [Resource Manager API](https://msdn.microsoft.com/en-us/library/azure/dn790568.aspx).
- [x-nullable](#x-nullable) - when `true`, specifies that `null` is a valid value for the associated schema
- [x-ms-header-collection-prefix](#x-ms-header-collection-prefix) - Handle collections of arbitrary headers by distinguishing them with a specified prefix.

### Microsoft Azure Extensions (available in most generators only when using `--azure-arm`)

- [x-ms-odata](#x-ms-odata) - indicates the operation includes one or more [OData](http://www.odata.org/) query parameters.
- [x-ms-azure-resource](#x-ms-azure-resource) - indicates that the [Definition Schema Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#schemaObject) is a resource as defined by the [Resource Manager API](https://msdn.microsoft.com/en-us/library/azure/dn790568.aspx)
- [x-ms-request-id](#x-ms-request-id) - allows to overwrite the request id header name
- [x-ms-client-request-id](#x-ms-client-request-id) - allows to overwrite the client request id header name
- [x-ms-arm-id-details](#x-ms-arm-id-details) - indicates the allowed resources that can be referred to by an `arm-id` formatted string field.

### Metadata extensions

Those extensions are defined as additional description of the RestAPI, and do not trigger at the moment any changes in code generation.

- [x-ms-secret](#x-ms-secret) - This extension is used to annotate the secret property.
- [x-ms-identifiers](#x-ms-identifiers) - (InProgress) indicates the identifying properties of objects in the array
- [x-ms-azure-rbac-permissions-required](#x-ms-azure-rbac-permissions-required) - (InProgress) Specify permission exceptions for autogenerated public [Azure REST API reference](https://docs.microsoft.com/rest/api/azure/) documentation.

# Generic Extensions

## x-ms-code-generation-settings

`x-ms-code-generation-settings` extension on `info` element enables passing code generation settings via the OpenAPI definition.

**Parent element**: [Info Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#infoObject)

**Schema**:

| Field Name |        Type        | Description                                                                                                                            |
| ---------- | :----------------: | -------------------------------------------------------------------------------------------------------------------------------------- |
| .\*        | `string` or `bool` | **Required**. Field name should be a valid autorest.exe parameter. Value should be a valid string value or boolean for flag parameters |

**Example**:

```json5
"info": {
   "x-ms-code-generation-settings": {
      "header": "MIT",
      "internalConstructors": true,
      "useDateTimeOffset": true
   }
}
```

## x-ms-skip-url-encoding

By default, `path` parameters will be URL-encoded automatically. This is a good default choice for user-provided values. This is not a good choice when the parameter is provided from a source where the value is known to be URL-encoded. The URL encoding is NOT an idempotent operation. For example, the percent character "%" is URL-encoded as "%25". If the parameter is URL-encoded again, "%25" becomes "%2525". Mark parameters where the source is KNOWN to be URL-encoded to prevent the automatic encoding behavior.

**Parent element**: [Parameter Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#parameterObject)

**Schema**:
`true|false`

**Example**:

```json5
"parameters": [
  {
    "name": "databaseName",
    "in": "path",
    "type": "string",
    "required": true,
    "x-ms-skip-url-encoding": true
  }
]
```

## x-ms-enum

Enum definitions in OpenAPI indicate that only a particular set of values may be used for a property or parameter. When the property is represented on the wire as a string, it would be a natural choice to represent the property type in C# and Java as an enum. However, not all enumeration values should necessarily be represented as strongly typed enums - there are additional considerations, such as how often expected values might change, since adding a new value to a strongly typed enum is a breaking change requiring an updated API version. Additionally, there is some metadata that is required to create a useful enum, such as a descriptive name, which is not represented in vanilla OpenAPI. For this reason, enums are not automatically turned into strongly typed enum types - instead they are rendered in the documentation comments for the property or parameter to indicate allowed values. To indicate that an enum will rarely change and that C#/Java enum semantics are desired, use the `x-ms-enum` extension. Note that depending on the code generation language the behavior of this extension may differ.

In C# and Java, an enum type is generated and is declared as the type of the related request/response object. The enum is serialized as the string expected by the REST API.

**Parent element**: [Parameter Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#parameterObject), [Schema Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#schemaObject), [Items Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#itemsObject), or [Header Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#headerObject)

**Schema**:

| Field Name    |                          Type                           | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| ------------- | :-----------------------------------------------------: | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| name          |                        `string`                         | **Required**. Specifies the name for the Enum.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| modelAsString |                        `boolean`                        | **Default: true** When set to `true` the enum will be modeled as a string. No validation will happen. When set to `false`, it will be modeled as an enum if that language supports enums. Validation will happen, irrespective of support of enums in that language.                                                                                                                                                                                                                                                                                  |
| values        | `[{ value: any, description?: string, name?: string }]` | **Default: undefined** When set, this will override the values specified with `enum`, while also enabling further customization. We recommend still specifying `enum` as a fallback for consumers that don't understand `x-ms-enum`. Each item in `x-ms-enum` corresponds to an enum item. Property `value` is mandatory and corresponds to the value one would also have specified using `enum`. Properties `description` and `name` are optional. `name` allows overriding the name of the enum value that would usually be derived from the value. |

**Example**:

```yaml
accountType:
  type: string
  enum:
    - Standard_LRS
    - Standard_ZRS
    - Standard_GRS
    - Standard_RAGRS
    - Premium_LRS
  x-ms-enum:
    name: AccountType
    modelAsString: false
    values:
      - value: Standard_LRS
        description: Locally redundant storage.
        name: StandardLocalRedundancy
      - value: Standard_ZRS
        description: Zone-redundant storage.
      - value: Standard_GRS
        name: StandardGeoRedundancy
      - value: Standard_RAGRS
      - value: Premium_LRS
```

### Single value enum

- `x-ms-enum.modelAsString=true` **(Default)**

Will be treated as an extensible enum(Same as with multi value enum)

- `x-ms-enum.modelAsString=false`

- If the **single value** enum is a **required** model property or a **required** then it will be treated as a Constant behind the scene. The SDK should automatically set that value and the parameter will not be on the operation signature.
- If the **single value** enum is an **optional** model property or an **optional** parameter, it will be treated as an optional parameter where the enum value can be set or not to that unique option.

## x-ms-parameter-grouping

By default operation parameters are generated in the client as method arguments. This behavior can sometimes be undesirable when the number of parameters is high. `x-ms-parameter-grouping` extension is used to group multiple primitive parameters into a composite type to improve the API.

**Parent element**: [Parameter Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#parameterObject)

**Schema**:

| Field Name |   Type   | Description                                                                                                                                 |
| ---------- | :------: | ------------------------------------------------------------------------------------------------------------------------------------------- |
| name       | `string` | When set, specifies the name for the composite type.                                                                                        |
| postfix    | `string` | Alternative to `name` parameter. If specified the name of the composite type will be generated as follows `{MethodGroup}{Method}{Postfix}`. |

If none of the parameters are set the name of the composite type is generated as follows `{MethodGroup}{Method}Parameters`.

**Example**:

```json5
"/some/{pathParam1}/{pathParam2}": {
  "operationId": "Update",
  "post": {
    "parameters": [
    {
        "name": "headerParam",
        "in": "header",
        "type": "string",
        "required": false,
        "x-ms-parameter-grouping": {
          "name": "custom-parameter-group"
        }
    },
    {
        "name": "pathParam1",
        "in": "path",
        "type": "string",
        "required": true,
        "x-ms-parameter-grouping": {
          "name": "custom-parameter-group"
        }
    },
    {
        "name": "pathParam2",
        "in": "path",
        "type": "string",
        "required": true,
        "x-ms-parameter-grouping": {
          "name": "custom-parameter-group"
        }
    }]
  }
}
```

Above OpenAPI definition will produce a type CustomParameterGroup with 3 properties (if applicable in the generator language).

## x-ms-parameter-location

By default Autorest processes global parameters as properties on the client. For example `subscriptionId` and `apiVersion` which are defined in the global parameters section end up being properties of the client. It would be natural to define resourceGroupName once in the global parameters section and then reference it everywhere, rather than repeating the same definition inline everywhere. One **may not** want resourceGroupName as a property on the client, just because it is defined in the global parameters section. This extension helps you achieve that. You can add this extension with value "method"
`"x-ms-parameter-location": "method"` and resourceGroupName will not be a client property.

Note:

- Valid values for this extension are: **"client", "method"**.
- **This extension can only be applied on global parameters. If this is applied on any parameter in an operation then it will be ignored.**

**Example:**

```json5
{
  "swagger": "2.0",
  "host": "management.azure.com",
  "info": {
    "title": "AwesomeClient",
    "version": "2015-05-01"
  },
  "paths": {
    "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Storage/storageAccounts/{accountName}": {
      "put": {
        "operationId": "StorageAccounts_Create",
        . . .
        "parameters": [
          {
            "$ref": "#/parameters/ResourceGroupName"   <<<<<<<<<<<<<<<<<<<<
          },
          {
            "name": "accountName",
            "in": "path",
            "required": true,
            "type": "string",
            "description": "The name of the storage account within the specified resource group. Storage account names must be between 3 and 24 characters in length and use numbers and lower-case letters only.  "
          },
          {
            "name": "parameters",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/StorageAccountCreateParameters"
            },
            "description": "The parameters to provide for the created account."
          },
          {
            "$ref": "#/parameters/ApiVersionParameter"
          },
          {
            "$ref": "#/parameters/SubscriptionIdParameter"
          }
        ]
        . . .
      }
    }
  },
  . . .
  "parameters": {
    "SubscriptionIdParameter": {
      "name": "subscriptionId",
      "in": "path",
      "required": true,
      "type": "string",
      "description": "Gets subscription credentials which uniquely identify Microsoft Azure subscription. The subscription ID forms part of the URI for every service call."
    },
    "ApiVersionParameter": {
      "name": "api-version",
      "in": "query",
      "required": true,
      "type": "string",
      "description": "Client Api Version."
    },
    "ResourceGroupName": {
      "description": "The name of the resource group within the user’s subscription.",
      "in": "path",
      "name": "resourceGroupName",
      "required": true,
      "type": "string",
      "x-ms-parameter-location": "method" <<<<<<<<<<<<<<<<<<<<<<<<<<<
    }
  }
}
```

- After using the `"x-ms-parameter-location": "method"` extension the generated client will have a method that looks like this:
  - Notice that `resourceGroupName` is the method parameter and not a client property

```csharp
public static StorageAccount Create(this IStorageAccountsOperations operations, string resourceGroupName, string accountName, StorageAccountCreateParameters parameters);
```

- The client constructor looks like this:

```csharp
public partial class StorageManagementClient : ServiceClient<StorageManagementClient>, IStorageManagementClient, IAzureClient
{
    public string SubscriptionId { get; set; } //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

    public string ApiVersion { get; private set; }  //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

    public StorageManagementClient(Uri baseUri, ServiceClientCredentials credentials, params DelegatingHandler[] handlers) : this(handlers)
    {
        if (baseUri == null)
        {
            throw new ArgumentNullException("baseUri");
        }
        if (credentials == null)
        {
            throw new ArgumentNullException("credentials");
        }
        this.Credentials = credentials;
        if (this.Credentials != null)
        {
            this.Credentials.InitializeServiceClient(this);
        }
    }

    private void Initialize()
    {
        this.StorageAccounts = new StorageAccountsOperations(this);
        this.Usage = new UsageOperations(this);
        this.BaseUri = new Uri("https://management.azure.com");
        this.ApiVersion = "2016-01-01";
        . . .
    }
}
```

## x-ms-paths

OpenAPI 2.0 has a built-in limitation on paths. Only one operation can be mapped to a path and http method. There are some APIs, however, where multiple distinct operations are mapped to the same path and same http method. For example `GET /mypath/query-drive?op=file` and `GET /mypath/query-drive?op=folder` may return two different model types (stream in the first example and JSON model representing Folder in the second). Since OpenAPI does not treat query parameters as part of the path the above 2 operations may not co-exist in the standard "paths" element.

To overcome this limitation an "x-ms-paths" extension was introduced parallel to "paths". URLs under "x-ms-paths" are allowed to have query parameters for disambiguation, however they are not actually used.

**Parent element**: [Swagger Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#swaggerObject)

**Schema**:
The `x-ms-paths` extension has the same schema as [Paths Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#pathsObject) with exception that [Path Item Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#pathItemObject) can have query parameters.

**Example**:

```yaml
paths:
   "/pets":
        get:
            ...
x-ms-paths:
   "/pets?color={color}":
        get:
            parameters:
              - name: color
                in: query
                # Declaring this parameter is still necessary!
                # The `?color={color}` part of the path is
                # completely ignored and only serves the purpose
                # of disambiguation and documentation.
            ...
```

As in the example above, there should be one "overload" of the operation in the `paths` section.
While technically this is not necessary (one could have put both `/pets` and `/pets?color={color}` into `x-ms-paths`), it makes sense to resort to `x-ms-paths` as little as possible in order to provide other OpenAPI tools with as much information as possible.
We recommend putting the most generic overload into the `paths` section.

## x-ms-client-name

In some situations, data passed by name, such as query parameters, entity headers, or elements of a JSON document body, are not suitable for use in client-side code.
For example, a header like 'x-ms-version' would turn out like xMsVersion, or x_ms_version, or XMsVersion, depending on the preferences of a particular code generator.
It may be better to allow a code generator to use 'version' as the name of the parameter in client code.

By using the 'x-ms-client-name' extension, a name can be defined for use specifically in code generation, separately from the name on the wire.
It can be used for query parameters and header parameters, as well as properties of schemas.

**Parameter Example**:

```json5
  "parameters": {
    "ApiVersionParameter": {
      "name": "x-ms-version",
      "x-ms-client-name": "version",
      "in": "header",
      "required": false,
      "type": "string",
      "x-ms-global": true,
      "enum": [
        "2015-04-05",
        "2014-02-14",
        "2013-08-15",
        "2012-02-12",
        "2011-08-18",
        "2009-09-19",
        "2009-07-17",
        "2009-04-14"
      ],
      "default": "2015-04-05",
      "description": "Specifies the version of the operation to use for this request."
    }
```

**Property Example**:

```json5
{
  "definitions": {
    "Product": {
      "x-ms-external" : true,
      "properties": {
        "product_id": {
          "type": "string"
		  "x-ms-client-name": "SKU"
        }
     }
  }
}
```

## x-ms-external

To allow generated clients to share models via shared libraries an `x-ms-external` extension was introduced. When a [Schema Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#schema-object) contains this extensions it's definition will be excluded from generated library. Note that in strongly typed languages the code will not compile unless the assembly containing the type is referenced with the project/library.

**Parent element**: [Schema Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#schema-object)

**Schema**:
`true|false`

**Example**:

```json5
{
  "definitions": {
    "Product": {
      "x-ms-external" : true,
      "properties": {
        "product_id": {
          "type": "string"
        }
     }
  }
}
```

## x-ms-discriminator-value

Swagger 2.0 specification requires that when used, the value of `discriminator` field MUST match the name of the schema or any schema that inherits it. To overcome this limitation `x-ms-discriminator-value` extension was introduced.

**Schema**:
`string` - the expected value of the `discriminator` field on the wire.

**Parent element**: [Schema Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#schemaObject)

**Example**:

```json5
"definitions": {
  "SqlDefinition": {
      "x-ms-discriminator-value": "USql",
      "allOf": [
        {
          "$ref": "#/definitions/SqlProperties"
        }
      ]
   }
}
```

## x-ms-client-flatten

This extension allows to flatten deeply nested payloads into a more user friendly object. For example a payload that looks like this on the wire:

```json5
{
  template: {
    name: "some name",
    properties: {
      prop1: "value1",
      prop2: "value2",
      url: {
        value: "http://myurl",
      },
    },
  },
}
```

can be transformed into the following client model:

```cs
public class Template
{
    public string Name {get;set;}
    public string Prop1 {get;set;}
    public string Prop2 {get;set;}
    public string UrlValue {get;set;}
}
```

by using the following OpenAPI definition:

```json5
"definitions": {
  "template": {
    "properties": {
      "name": {
        "type": "string"
      },
      "properties": {
        "x-ms-client-flatten": true,
        "$ref": "#/definitions/templateProperties"
      }
    }
  }
}
```

It's also possible to flatten body parameters so that the method will look like this:

```cs
client.DeployTemplate("some name", "value1", "value2", "http://myurl");
```

by using the following OpenAPI definition:

```json5
"post": {
  "operationId": "DeployTemplate",
  "parameters": [
  {
     "name": "body",
     "in": "body",
     "x-ms-client-flatten": true,
     "schema": {
       "$ref": "#/definitions/template"
     }
    }
  ]
}
```

**Parent element**: [Parameter Objects](https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#parameterObject) or [Property on the Schema Definition](https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#schemaObject). In both cases the `type` of the parameter or property should be a complex schema with properties.

**Schema**:
`true|false`

**Example**:

```json5
"definitions": {
  "template": {
    "properties": {
      "name": {
        "type": "string"
      },
      "properties": {
        "x-ms-client-flatten": true,
        "$ref": "#/definitions/templateProperties"
	    }
    }
  }
}
```

and

```json5
"post": {
  "operationId": "DeployTemplate",
  "parameters": [
  {
     "name": "body",
     "in": "body",
     "x-ms-client-flatten": true,
     "schema": {
       "$ref": "#/definitions/template"
     }
    }
  ]
}
```

## x-ms-parameterized-host

When used, replaces the standard OpenAPI "host" attribute with a host that contains variables to be replaced as part of method execution or client construction, very similar to how path parameters work.

**Parent element**: [Swagger Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#swagger-object)

**Schema**:

| Field Name          |                                                          Type                                                          | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ------------------- | :--------------------------------------------------------------------------------------------------------------------: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| hostTemplate        |                                                        `string`                                                        | **Required**. Specifies the parameterized template for the host.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| useSchemePrefix     |                                                       `boolean`                                                        | **Optional, Default: true**. Specifies whether to prepend the default scheme a.k.a protocol to the base uri of client.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| positionInOperation |                                                        `string`                                                        | **Optional, Default: first**. Specifies whether the list of parameters will appear in the beginning or in the end, in the method signature for every operation. The order within the parameters provided in the below mentioned array will be preserved. Either the array of parameters will be prepended or appended, based on the value provided over here. Valid values are **"first", "last"**. Every method/operation in any programming language has parameters categorized into two buckets **"required"** and **"optional"**. It is natural for optional parameters to appear in the end in a method signature. **This aspect will be preserved, while prepending(first) or appending(last) hostTemplate parameters .** |
| parameters          | [Array of Parameter Objects](https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#parameterObject) | The list of parameters that are used within the hostTemplate. This can include both reference parameters as well as explicit parameters. Note that "in" is **required** and **must be** set to **"path"**. The reference parameters will be treated as **global parameters** and will end up as property of the client.                                                                                                                                                                                                                                                                                                                                                                                                         |

**Example**:

- Using both explicit and reference parameters.
  - Since "useSchemePrefix" is not specified, it's default value true will be applied. The user is expected to provide only the value of accountName. The generated code will fit it as a part of the url.
  - Since "positionInOperation" with value "last" is specified, "accountName" will be the last required parameter in every method. "adlaJobDnsSuffixInPath" will be a property on the client as it is defined in the global parameters section and is referenced here.

```json5
"x-ms-parameterized-host": {
    "hostTemplate": "{accountName}.{adlaJobDnsSuffix}",
    "positionInOperation": "last",
    "parameters": [
      {
        "name": "accountName",
        "description": "The Azure Data Lake Analytics account to execute job operations on.",
        "required": true,
        "type": "string",
        "in": "path",
        "x-ms-skip-url-encoding": true
      },
      {
        "$ref": "#/parameters/adlaJobDnsSuffixInPath"
      }
    ]
  }
...
"adlaJobDnsSuffixInPath": {
      "name": "adlaJobDnsSuffix",
      "in": "path",
      "required": true,
      "type": "string",
      "default": "azuredatalakeanalytics.net",
      "x-ms-skip-url-encoding": true,
      "description": "Gets the DNS suffix used as the base for all Azure Data Lake Analytics Job service requests."
    }
```

- Using explicit parameters and specifying the positionInOperation and schemePrefix.
  - This means that accountName will be the first required parameter in all the methods and the user is expected to provide a url (protocol + accountName), since "useSchemePrefix" is set to false.

```json5
"x-ms-parameterized-host": {
    "hostTemplate": "{accountName}.mystaticsuffix.com",
    "useSchemePrefix": false,
    "positionInOperation": "first",
    "parameters": [
      {
        "name": "accountName",
        "description": "The Azure Data Lake Analytics account to execute job operations on.",
        "required": true,
        "type": "string",
        "in": "path",
        "x-ms-skip-url-encoding": true
      }
    ]
  }
```

## x-ms-mutability

This extension offers insight to Autorest on how to generate code (mutability of the property of the model classes being generated). It doesn't alter the modeling of the actual payload that is sent on the wire.

It is an array of strings with three possible values. The array cannot have repeatable values. Valid values are: **"create", "read", "update"**.

| Field Name | Description                                                                                             |
| ---------- | :------------------------------------------------------------------------------------------------------ |
| **create** | Indicates that the value of the property can be set while creating/initializing/constructing the object |
| **read**   | Indicates that the value of the property can be read                                                    |
| **update** | Indicates that value of the property can be updated anytime(even after the object is created)           |

### Rules:

- When the extension is applied with all the three values; `"x-ms-mutability": ["create", "read", "update"]` (order of the values is not important) **OR** when this extension is not applied on a model property; it has the same effect in both the cases. Thus applying this extension with all the three values on all the settable properties is not required. This will ensure the spec is visibly cleaner.
- When a property is modeled as `"readonly": true` then,
  - if the x-ms-mutability extension is applied then it can **only have "read" value in the array**.
  - applying the extension as `"x-ms-mutability": ["read"]` or not applying it will have the same effect.
- When the property is modeled as **`"readonly": false`** then,
  - applying the extension as `"x-ms-mutability": ["read"]` can be used to work around Swagger 2.0 spec limitation when `readonly: true` is not allowed.(e.g. Have a response property `readonly` that will always be present in the model.)
  - applying the extension as `"x-ms-mutability": ["create", "read", "update"]` or not applying it will have the same effect.
  - applying the extension with another **permissible valid combination** should be fine.
- When this extension is applied on a collection (array, dictionary) then this will have effects on the mutability (adding/removing elements) of the collection. Mutability of the collection cannot be applied on its elements. The mutability of the element will be governed based on the mutability defined in the element's definition.

Examples:

- Mutability on a model definition

```json5
"definitions": {
  "Resource": {
    "description": "The Resource Model definition.",
    "properties": {
      "id": {
        "readOnly": true,
        "type": "string",
        "description": "Resource Id",
        "x-ms-mutability": ["read"]
      },
      "name": {
        "type": "string",
        "description": "Resource name"
      },
      "type": {
        "type": "string",
        "description": "Resource type",
        "x-ms-mutability": ["read"]
      },
      "location": {
        "type": "string",
        "description": "Resource location",
        "x-ms-mutability": ["create", "read"]
      },
      "tags": {
        "type": "object",
        "additionalProperties": {
          "type": "string"
        },
        "description": "Resource tags",
        "x-ms-mutability": ["create", "read", "update"]
      }
    },
    "required": [
      "location"
    ],
    "x-ms-azure-resource": true
  }
}
```

- Mutability of the object property; which is a collection of items

```json5
"definitions": {
  "ResourceCollection": {
    "description": "Collection of Resource objects. Resource is defined in the above example.",
    "properties": {
      "value": {
        "type": "array",
        "description": "Array of Resource objects.",
        "x-ms-mutability": ["create", "read", "update"], //This means that the array is mutable
        "items": {
          "type": object,
          "x-ms-mutability": ["create", "read"] // X - Applying mutability on the itemType of the array or valueType of the dictionary is not allowed.
          "schema": {
            "$ref": "#/definitions/Resource" // The mutability of the properties of the Resource object is governed by the mutability defined in it's model definition.
          }
        }
      }
    }
  }
}
```

## x-ms-examples

Describes the format for specifying examples for request and response of an operation in an OpenAPI definition. It is a **dictionary** of different variations of the examples for a given operation.

More information about this extension can be found [here](https://github.com/Azure/azure-rest-api-specs/tree/master/documentation/x-ms-examples.md).

# Microsoft Azure Extensions (available in most generators only when using `--azure-arm`)

## x-ms-odata

When present the `x-ms-odata` extensions indicates the operation includes one or more [OData](http://www.odata.org/) query parameters. These parameters include `$filter`, `$top`, `$orderby`, `$skip`, and `$expand`. In some languages the generated method will expose these parameters as strongly types OData type.

**Schema**:
[`ref`](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#referenceObject) to the definition that describes object used in filter.

**Parent element**: [Operation Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#operationObject)

**Example**:

```json5
"paths": {
  "/subscriptions/resource": {
    "get": {
      "x-ms-odata": "#/definitions/Product"
    }
  }
}
```

## x-ms-error-response

Indicates whether the response status code should be treated as an error response or not.

**Parent element**: [Response Object](https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#response-object)

**Schema**:
`true|false`

**Example**:

```json5
. . .
  "responses": {
    "200": {
      "description": "",
      "schema": {
        "$ref": "#/definitions/Pet"
      }
    },
    "202": {
      "description": "something something dark side"
    },
    "404": {
      "description": "Not found",
      "schema": {
        "$ref": "#/definitions/NotFoundErrorBase"
      },
      "x-ms-error-response": true
    },
    "400": {
      "description": "Bad request",
      "schema": {
        "type": "string"
      },
      "x-ms-error-response": true
    },
    "501": {
      "description": "Some unexpected error",
      "schema": {
        "type": "integer"
      },
      "x-ms-error-response": true
    },
    "default": {
      "description": "default stuff"
    }
  }
. . .
```

## x-ms-text

Swagger spec doesn't allow dev to model this XML structure: `<title language="text">the title</title>`
This is well known issue: https://github.com/OAI/OpenAPI-Specification/issues/630

This extension is defined to help for this scenario.

Note: The extension is not tight to this particular scenario (you could model any text node that way), but we recommend to follow as much as possible the Swagger specification, and to use it only in case of attributes/text.

**Parent element**: [XML Object](https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#xml-object)

**Schema**:
`true|false`

**Example**:

```json5
. . .
    "properties":{
        "language": {
          "xml": {
            "attribute": true,
            "name": "language"
          },
          "type": "string",
          "description": "Returned value should be 'english'"
        },
        "content": {
          "xml": {
            "x-ms-text": true
          },
          "description": "Returned value should be 'I am text'",
          "type": "string"
        }
      },
. . .
```

## x-ms-client-default

Set the default value for a property or a parameter on the client.
With this extension, you can set a default value for a property or parameter that is independent of how the property / parameter's schema is handling a default.

**`x-ms-client-default` vs `default`:**

- `default`: This represent the server default. From the point of view of the client this is just documentation, it will be ignored.
- `x-ms-client-default`: This represent the default on the client. It can be used to make a required property optional.

**Parent element**: [Parameter Objects](https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#parameterObject) or [Property on the Schema Definition](https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#schemaObject).

**Schema**:
`string`, `integer`, `long`, `float`, `double`, `boolean` - the default value for the property / parameter

**Parameter Example**:

```json5
. . .
    "parameters": [
      {
        "name": "parameterWithClientDefault",
        "in": "query",
        "type": "string",
        "enum": [
          "value1",
          "value2"
        ],
        "x-ms-enum": {
          "name": "ParameterWithClientDefaultEnum",
          "modelAsString": false
        },
        "required": true,
        "x-ms-client-default": "value1"
      }
    ],
. . .
```

**Property Example**:

```json5
. . .
    "properties": {
      "propertyWithClientDefault": {
          "type": "string",
          "enum": [
              "value1",
              "value2"
          ],
          "x-ms-enum": {
              "name": "PropertyWithClientDefaultEnum",
              "modelAsString": true
          },
          "x-ms-client-default": "value1"
      }
    }
. . .
```

## x-ms-pageable

The REST API guidelines define a common pattern for paging through lists of data. The operation response is modeled in OpenAPI as a list of items (a "page") and a link to the next page, effectively resembling a singly linked list. Tag the operation as `x-ms-pageable` and the generated code will include methods for navigating between pages.

**Note:** The request to the nextLink URL will be a `GET` request unless `operationName` is specified. If `operationName` is specified, the request will use the HTTP method for that operation.

**Schema**:

| Field Name    |   Type   | Description                                                                                                                                                                                                                                                                                                                                                                                                               |
| ------------- | :------: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| itemName      | `string` | Optional (default: `value`). Specifies the name of the property that provides the collection of pageable items.                                                                                                                                                                                                                                                                                                           |
| nextLinkName  | `string` | Required. Specifies the name of the property that provides the next link (common: `nextLink`). If the model does not have a next link property then specify `null`. This is useful for services that return an object that has an array referenced by `itemName`. The object is then flattened in a way that the array is _directly_ returned, no paging is used. This provides a better client side API to the end user. |
| operationName | `string` | Optional (default: `<operationName>Next`). Specifies the name (operationId) of the operation for retrieving the next page.                                                                                                                                                                                                                                                                                                |

**Parent element**: [Operation Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#operationObject)

**Example 1: Canonical**

Basic use of `x-ms-pageable`:

```YAML
swagger: '2.0'
info:
  version: 1.0.0
  title: Simple API
produces:
  - application/json
paths:
  /getIntegers:
    get:
      operationId: list
      description: "Gets those integers."
      x-ms-pageable:                            # EXTENSION
        nextLinkName: nextLink                  # property name for next page URL
      responses:
        200:
          description: OK
          schema:
            $ref: '#/definitions/PagedIntegerCollection'
definitions:
  PagedIntegerCollection:
    description: "Page of integers."
    type: object
    properties:
      value:                                    # the current page
        type: array
        items:
          type: integer
      nextLink:                                 # next page URL (referred to by "nextLinkName")
        type: string
```

Generated signatures:

```C#
IPage<int?>       List(ISimpleAPIClient operations);
Task<IPage<int?>> ListAsync(ISimpleAPIClient operations, CancellationToken cancellationToken);
IPage<int?>       ListNext(ISimpleAPIClient operations, string nextPageLink);
Task<IPage<int?>> ListNextAsync(ISimpleAPIClient operations, string nextPageLink, CancellationToken cancellationToken);
```

- Swagger example: [pollingPaging.json](https://github.com/Azure/autorest/blob/main/docs/openapi/examples/pollingPaging.json#L53)

**Example 2: Customized**

Customizing code generation:

```YAML
swagger: '2.0'
info:
  version: 1.0.0
  title: Simple API
produces:
  - application/json
paths:
  /getIntegers:
    get:
      operationId: list
      description: "Gets those integers."
      x-ms-pageable:                            # EXTENSION
        nextLinkName: nextIntegersUrl           # property name for next page URL
        value: payload                          # property name for current page (overrides "value")
        operationName: listMore                 # method name for retrieving next page (overrides "listNext")
      responses:
        200:
          description: OK
          schema:
            $ref: '#/definitions/PagedIntegerCollection'
definitions:
  PagedIntegerCollection:
    description: "Page of integers."
    type: object
    properties:
      payload:                                  # the current page (referred to by "value")
        type: array
        items:
          type: integer
      nextIntegersUrl:                          # next page URL (referred to by "nextLinkName")
        type: string
```

Generated signatures:

```C#
IPage<int?>       List(ISimpleAPIClient operations);
Task<IPage<int?>> ListAsync(ISimpleAPIClient operations, CancellationToken cancellationToken);
IPage<int?>       ListMore(ISimpleAPIClient operations, string nextPageLink);
Task<IPage<int?>> ListMoreAsync(ISimpleAPIClient operations, string nextPageLink, CancellationToken cancellationToken);
```

**Example 3: Single page result**

Providing a better user experience for single page response models:

```YAML
swagger: '2.0'
info:
  version: 1.0.0
  title: Simple API
produces:
  - application/json
paths:
  /getIntegers:
    get:
      operationId: list
      description: "Gets those integers."
      x-ms-pageable:
        nextLinkName: null                      # there are no further pages
        value: payload                          # property name for the "page" (overrides "value")
      responses:
        200:
          description: OK
          schema:
            $ref: '#/definitions/PagedIntegerCollection'
definitions:
  PagedIntegerCollection:
    description: "Page of integers."
    type: object
    properties:
      payload:                                  # the only "page" (referred to by "value")
        type: array
        items:
          type: integer
```

Generated signatures:

```C#
IEnumerable<int?>       List(ISimpleAPIClient operations);
Task<IEnumerable<int?>> ListAsync(ISimpleAPIClient operations, CancellationToken cancellationToken);
```

## x-ms-long-running-operation

Some requests like creating/deleting a resource cannot be carried out immediately. In such a situation, the server sends a 201 (Created) or 202 (Accepted) and provides a link to monitor the status of the request. When such an operation is marked with extension `"x-ms-long-running-operation": true`, in OpenAPI, the generated code will know how to fetch the link to monitor the status. It will keep on polling at regular intervals till the request reaches one of the terminal states: Succeeded, Failed, or Canceled.

## x-ms-long-running-operation-options

When `x-ms-long-running-operation-options` is specified, there should also be a `x-ms-long-running-operation: true` specified.

See [Azure RPC Spec](https://github.com/Azure/azure-resource-manager-rpc/blob/master/v1.0/Addendum.md#asynchronous-operations) for asynchronous operation notes.

**You probably don't need to use this option if you follow ARM guidelines**. This option is designed for cases where the server do NOT follow ARM, and we need to guide the runtime through a peculiar flow.

**Schema**:
Field Name | Type | Description
---|:---:|---
final-state-via | `string` - one of `azure-async-operation` or `location` or `original-uri` or `operation-location` | `final-state-via` SHOULD BE one of

- `azure-async-operation` - poll until terminal state, skip any final GET on Location or Origin-URI and use the final response at the uri pointed to by the header `Azure-AsyncOperation`.
- `location` - poll until terminal state, if the initial response had a `Location` header, a final GET will be done. Default behavior for POST operation.
- `original-uri` - poll until terminal state, a final GET will be done at the original resource URI. Default behavior for PUT operations.
- `operation-location` - poll until terminal state, skip any final GET on Location or Origin-URI and use the final response at the uri pointed to by the header `Operation-Location`

The polling mechanism in itself remains unchanged, the only impact of this option could be to do an additional final GET, or skip a final GET.

**Parent element**: [Operation Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#operationObject)

**Example**:

```json5
"paths": {
  "/products/{name}": {
    "put": {
      "operationId": "products_create",
      "x-ms-long-running-operation": true,
      "x-ms-long-running-operation-options" : {
          "final-state-via" : "location"
      },
      "description": "A pageable list of Products."
    }
  }
}
```

- Swagger example: [pollingPaging.json](https://github.com/Azure/autorest/blob/main/docs/openapi/examples/pollingPaging.json#L19)

## x-ms-azure-resource

Resource types as defined by the [Resource Manager API](https://msdn.microsoft.com/en-us/library/azure/dn790568.aspx) are tagged by using a `x-ms-azure-resource` extension.

**Parent element**: [Schema Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#schemaObject)

**Schema**:
`true|false`

**Example**:

```json5
"Resource": {
  "x-ms-azure-resource": true,
  "properties": {
    "id": {
      "type": "string",
      "readOnly": true,
      "description": "Resource Id"
    }
  }
}
```

## x-ms-request-id

When set, allows to overwrite the `x-ms-request-id` response header (default is x-ms-request-id).

**Parent element**: [Operation Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#operationObject)

**Schema**:
`string` - the name of the request id header to use when setting Response.RequestId property.

**Example**:

```json5
"paths": {
  "/products/{name}": {
    "get": {
      "operationId": "products_create",
      "x-ms-request-id": "request-id"
    }
  }
}
```

## x-ms-client-request-id

When set, specifies the header parameter to be used instead of `x-ms-client-request-id` (default is x-ms-client-request-id).

**Parent element**: [Header Parameter Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#parameterObject)

**Schema**:
`string` - the name of the client request id header to use when setting sending request.

**Example**:

```json5
"paths": {
  "/products/{name}": {
    "get": {
      "operationId": "products_create",
      "parameters": [{
        "name": "x-ms-client-request-id",
        "in": "header",
        "type": "string",
        "required": false,
        "x-ms-client-request-id": true
      }]
    }
  }
}
```

## x-ms-arm-id-details

Can only be set on `"type": "string"` fields with `"format": "arm-id"`.

When set, specifies the set of resource types which can be referenced by this `arm-id`. If this extension isn't provided for a particular `arm-id`, the field can refer to any valid ARM ID.

**Parent element**: [Parameter Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#parameterObject), [Schema Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#schemaObject), or [Items Object](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#itemsObject)

### Schema

| Field Name       | Type                | Description                                                                                                                                          |
| ---------------- | ------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| allowedResources | `[AllowedResource]` | **Required** An array of allowed ARM resources. Each element represents a particular type of ARM resource which can be referred to by this `arm-id`. |

**AllowedResource schema**:

| Field Name | Type       | Description                                                                                                                                                                                                         |
| ---------- | ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| scopes     | `[string]` | An array of scopes. See [Allowed Scopes](#allowed-scopes). If not specified, the default scope is `["ResourceGroup"]`.                                                                                              |
| type       | `string`   | **Required** The type of resource that is being referred to. For example `Microsoft.Network/virtualNetworks` or `Microsoft.Network/virtualNetworks/subnets`. See [Example Types](#example-types) for more examples. |

#### Allowed Scopes

The following values are allowed for `scopes`. These values were derived from the [scope field in ARM templates](https://docs.microsoft.com/azure/azure-resource-manager/templates/scope-extension-resources?tabs=azure-cli).
| Scope | URL prefix | Meaning |
| ----------------- | ------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Tenant` | `/` | The resource is deployed into a tenant |
| `Subscription` | `/subscriptions/{subscriptionId}/` | The resource is deployed into a subscription |
| `ResourceGroup` | `/subscriptions/{subscriptionId}/resourceGroups/{group}` | The resource is deployed into a resource group |
| `ManagementGroup` | `/providers/Microsoft.Management/managementGroups/{managementGroupName}/` | The resource is deployed into a management group |
| `Extension` | `{parentScope}/providers/{extensionNamespace}/{extensionType}/{extensionName}/` | The resource is an extension resource and may be deployed as a subresource of another resource. `parentScope` may be a resource in any of the above scopes. |
| `*` | Any of the above | The resource may be deployed into any of the above scopes. This is identical to `["Tenant", "Subscription", "ResourceGroup", "ManagementGroup", "Extension"`] |

#### Example Types

Below is a table showing an example entry for various different kinds of resource types

| Resource kind                          | Example                                                                      |
| -------------------------------------- | ---------------------------------------------------------------------------- |
| Resource in a tenant                   | `{"scopes": ["Tenant"], "type": "Microsoft.Capacity/reservationOrders"}`     |
| Resource in a subscription             | `{"scopes": ["Subscription"], "type": "Microsoft.Resources/resourceGroups"}` |
| Resource in a resource group           | `{"scopes": ["ResourceGroup"], "type": "Microsoft.Network/virtualNetworks"}` |
| Resource in a management group         | `{"scopes": ["ManagementGroup"], "type": "Microsoft.Blueprint/blueprints"}`  |
| Extension resource                     | `{"scopes": ["Extension"], "type": "Microsoft.Authorization/locks"}`         |
| Any resource in resource group         | `{"scopes": ["ResourceGroup"], "type": "*"}`                                 |
| Any compute resource in resource group | `{"scopes": ["ResourceGroup"], "type": "Microsoft.Compute/*"}`               |

Sub-resources are specified in the same manner as their parent resource but with additional paths on the end. For example to refer to a subnet: `Microsoft.Network/virtualNetworks/subnets`.

**Note** that we do not currently support limiting references to an extension resource by the kind of resource it is on. For example you can refer to _any_ resource lock (`Microsoft.Authorization/locks`) but not to a resource lock but only when it's on a CosmosDB.

#### Examples

**Example**: An `arm-id` field that can refer to any ARM resource ID.

```json5
"MyExampleType": {
  "properties": {
    "id": {
      "type": "string",
      "format": "arm-id"
    }
  }
}
```

**Example**: An `arm-id` field that must refer to a virtual network

```json5
"MyExampleType": {
  "properties": {
    "vnetId": {
      "type": "string",
      "format": "arm-id",
      "x-ms-arm-id-details": {
        "allowedResources": [
          {
            "type": "Microsoft.Network/virtualNetworks"
          }
        ]
      }
    }
  }
}
```

**Example (preferred)**: An `arm-id` field with no additional information about what kind of resource it must refer to, referring to the common type.

```json5
"MyExampleType": {
  "properties": {
    "id": {
      "$ref": "../../../../../common-types/resource-management/v2/types.json#/definitions/ArmId",
    }
  }
}
```

**Example (preferred)**: An `arm-id` field that must refer to a virtual network, via a referenced definition

```json5
"MyExampleType": {
  "properties": {
    "vnetId": {
      "$ref": "#/definitions/VNetId",
    }
  }
},
"VNetId": {
  "type": "string",
  "format": "arm-id",
  "x-ms-arm-id-details": {
    "allowedResources": [
      {
        "type": "Microsoft.Network/virtualNetworks"
      }
    ]
  }
}
```

**Example**: An array of `arm-id`'s that refer to a subnet

```json5
"MyExampleType": {
  "properties": {
    "vnets": {
      "type": "array",
      "items": {
        "type": "string",
        "format": "arm-id",
        "x-ms-arm-id-details": {
          "allowedResources": [
            {
              "type": "Microsoft.Network/virtualNetworks/subnets"
            }
          ]
        }
      }
    }
  }
}
```

## x-nullable

Set `"x-nullable": true` on a schema to indicate that a `null` is a legal value. By default, a `null` value should be disallowed when forming a request and rejected during payload deserialization.

For arrays, sending/receiving a `null` array entry is not supported and should result in an error.

**Example**:
An operation that returns a scalar value or null.

```json
"responses": {
  "200": {
    "description": "The assigned integer, or null if unassigned.",
    "schema": {
      "type": "integer",
      "x-nullable": true
    }
  }
}
```

**Example**:
An operation that returns an object or null.

```json
"responses": {
  "200": {
    "description": "The active Widget or null.",
    "schema": {
      "x-nullable": true,
      "allOf": {
        "$ref": "#/definitions/Widget"
      }
    }
  }
}
```

**Example**:
A dictionary where a key's value can be null.

```json
{
  "name": "arrayBody",
  "in": "body",
  "schema": {
    "description": "Credential key/value pairs.  Set the credential key's value to null to remove the credential.",
    "type": "object",
    "credentials": {
      "type": "object",
      "additionalProperties": {
        "type": "string",
        "x-nullable": true
      }
    }
  }
}
```

**Example**:
An object with a nullable property.

```json
"Widget": {
  "type": "object",
  "properties": {
    "size": {
      "description": "widget size",
      "type": "integer"
    },
    "shape": {
      "description": "optional widget shape",
      "type": "string",
      "x-nullable": true
    }
  }
}
```

## x-ms-header-collection-prefix

Handle collections of arbitrary headers by distinguishing them with a specified prefix. Has different behavior if it refers to a request header or a response header:

- Request header: All keys in the request headers will be prefixed with the prefix value before being sent to the service.
- Response header: Only response headers that start with the prefix specified here will be returned to users. Additionally, the prefix will be stripped from the response header key before being returned to users

Additionally, applying this extension to a schema forces the schema to become a dictionary.

**Schema**: `string`. Name of the prefix you want to append / filter by. A common value for storage libraries is `x-ms-meta-`.

**Request Example**:

```json
"parameters": [
  {
    "name": "x-ms-meta",
    "in": "header",
    "type": "string",
    "x-ms-parameter-location": "method",
    "x-ms-header-collection-prefix": "x-ms-meta-"
  }
]
```

This request parameter will be forced to be a dictionary schema, and all keys in this dictionary will be prefixed with `x-ms-meta-`.
So, if you input a header with name `key` and value `value` through this parameter,

```
GET /path HTTP/1.1
x-ms-meta-key: value
```

is what reaches the service.

**Response Example**:

```json
"responses": {
  "200": {
    "description": "Success",
    "headers": {
      "x-ms-meta": {
        "type": "string",
        "x-ms-client-name": "Metadata",
        "x-ms-header-collection-prefix": "x-ms-meta-"
      }
    }
  }
}
```

This response header parameter will be forced to be a dictionary schema. Only entries with prefix `x-ms-meta-` will be returned to users,
and this prefix will be stripped before be returned to users. So if the response from the service is

```
headers:
  - rejected-key: value
  - x-ms-meta-key: value
```

What is returned to users is just `key: value`.

# Metadata Extensions

## x-ms-secret

This extension is used to annotate the secret property. The value type is boolean and the allowed value is either true or false. Secrets should never expose on a GET. If a secret does need to be returned after the fact, a POST api can be used to allow for granular RBAC.

**Rule**

- When applying this extensions as: "x-ms-secret": true; means that this property must not exist in response.
- When applying this extensions as: "x-ms-secret": false, it has same effect as not applying it.
- When a property is modeled as both "required" and "x-ms-secret": true, which means that this property must not exist in the response but has to be present in request.
- "x-ms-secret": true is equivalent to "x-ms-mutability": ["create", "update"].
- When a property is modeled as "x-ms-mutability": ["read"], then applying this extension as "x-ms-secret": true is not allowed.
- When a property is modeled as "readonly": true, then applying this extension as "x-ms-secret": true is not allowed.

**Schema**:
`true|false`

**Example**:

```json5
"SecretAuthInfo": {
      "type": "object",
      "description": "The authentication info when authType is secret",
      "properties": {
        "name": {
          "description": "Username or account name for secret auth.",
          "type": "string"
        },
        "secret": {
          "description": "Password or account key for secret auth.",
          "type": "string",
          "x-ms-secret": true
        }
    }
}
```

## x-ms-identifiers

(InProgress) This extension is used to indicate the identifying properties of objects in the array, e.g., `id`, `name`, `uid`.

**Rule**

- The default identifying property is `id`. You don't need to add this annotataion if there is the `id` property in the object model.
- If there is no appropriate identifying properties, leave it as an empty array.
- You can provide multiple properties to form the composite identifier.
- Use [json pointer](https://datatracker.ietf.org/doc/html/rfc6901) if the identifying property is an inner property. E.g., `"x-ms-identifiers": ["/properties/subnet/id"]`

**Schema**:
`array`

**Example**:

```json5
"myArrayProperty": {​
  "type":"array",
  "items": {
    "$ref":"#/definitions/Example"​
  },
  "x-ms-identifiers": ["propertyName"]​
}
```

## x-ms-azure-rbac-permissions-required

(InProgress) Specify permission exceptions for autogenerated public [Azure REST API reference](https://docs.microsoft.com/rest/api/azure/) documentation.

The doc processor has an opt-in option to autogenerate the required permissions by parsing the API. However, there will be situations where the autogeneration of the required permissions is not accurate. This extension enables you to specify permission exceptions for individual APIs.

**Permissions example #1**

Here is a [Virtual Machines - Get](https://docs.microsoft.com/rest/api/compute/virtual-machines/get) permissions example that **does not** require the `x-ms-azure-rbac-permissions-required` extension:

```
GET https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Compute/virtualMachines/{vmName}?api-version=2021-11-01
```

Autogenerated permissions from doc processor:

`Microsoft.Compute/virtualMachines/read`

**Permissions example #2**

Here is an [Assignments - Create Or Update](https://docs.microsoft.com/rest/api/blueprints/assignments/create-or-update) permissions example that **does** require the `x-ms-azure-rbac-permissions-required` extension:

```
PUT https://management.azure.com/{resourceScope}/providers/Microsoft.Blueprint/blueprintAssignments/{assignmentName}?api-version=2018-11-01-preview
```

Autogenerated permissions from doc processor:

`Microsoft.Blueprint/blueprintAssignments/write`

Actual permissions required to call API:

`Microsoft.Blueprint/blueprintAssignments/write and Microsoft.ManagedIdentity/userAssignedIdentities/assign/action`

**Schema**:

| Field Name                  |    Type    | Description                                                                          |
| --------------------------- | :--------: | ------------------------------------------------------------------------------------ |
| `actions`                   |  `string`  | List of the required action permissions for this API.                                |
| `dataActions`               |  `string`  | List of the required data action permissions for this API.                           |
| `rolesWithThesePermissions` | `[string]` | An array of roles that have the required permissions for this API.                   |
| `moreInfoLink`              |  `string`  | Link formatted as markdown with more information about the permissions for this API. |

For a list roles, see [Azure built-in roles](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles).

```json5
"xmsPermissions": {
  "type": "object",
  "properties": {
    "actions": {
      "type": "string"
    },
    "dataActions": {
      "type": "string"
    },
    "rolesWithThesePermissions": [
      "type": "string"
    ],
    "moreInfoLink": {
      "type": "string"
    }
  }
}
```

**Example**:

```json5
"x-ms-azure-rbac-permissions-required": {
  "actions": "Microsoft.Blueprint/blueprintAssignments/write and Microsoft.ManagedIdentity/userAssignedIdentities/assign/action",
  "dataActions": "",
  "rolesWithThesePermissions": [
    "Blueprint Operator"
  ],
  "moreInfoLink": "[Learn more](https://docs.microsoft.com/azure/governance/blueprints/how-to/configure-for-blueprint-operator)"
}
```

**Example**:

```json5
"x-ms-azure-rbac-permissions-required": {
  "actions": "",
  "dataActions": "Microsoft.Storage/storageAccounts/queueServices/queues/messages/process/action or (Microsoft.Storage/storageAccounts/queueServices/queues/messages/delete and Microsoft.Storage/storageAccounts/queueServices/queues/messages/read)",
  "rolesWithThesePermissions": [
    "Storage Queue Data Message Processor",
    "Storage Queue Data Contributor"
  ],
  "moreInfoLink": "[Authorize access to blobs and queues using Azure Active Directory](https://docs.microsoft.com/azure/storage/blobs/authorize-access-azure-active-directory)"
}
```
